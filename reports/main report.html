<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Response diversity and stability in the context of a pulse perturbation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="main report_files/libs/clipboard/clipboard.min.js"></script>
<script src="main report_files/libs/quarto-html/quarto.js"></script>
<script src="main report_files/libs/quarto-html/popper.min.js"></script>
<script src="main report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main report_files/libs/quarto-html/anchor.min.js"></script>
<link href="main report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="main report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="main report_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="main report_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#the-multispecies-model" id="toc-the-multispecies-model" class="nav-link" data-scroll-target="#the-multispecies-model">The multispecies model</a></li>
  <li><a href="#experimental-treatments" id="toc-experimental-treatments" class="nav-link" data-scroll-target="#experimental-treatments">Experimental treatments</a>
  <ul class="collapse">
  <li><a href="#pulse-pertubation-treatment" id="toc-pulse-pertubation-treatment" class="nav-link" data-scroll-target="#pulse-pertubation-treatment">Pulse pertubation treatment</a></li>
  <li><a href="#community-composition-treatment" id="toc-community-composition-treatment" class="nav-link" data-scroll-target="#community-composition-treatment">Community composition treatment</a></li>
  <li><a href="#strength-of-species-interactions-treatment" id="toc-strength-of-species-interactions-treatment" class="nav-link" data-scroll-target="#strength-of-species-interactions-treatment">Strength of species interactions treatment</a></li>
  </ul></li>
  <li><a href="#analyses" id="toc-analyses" class="nav-link" data-scroll-target="#analyses">Analyses</a>
  <ul class="collapse">
  <li><a href="#species-response-traits" id="toc-species-response-traits" class="nav-link" data-scroll-target="#species-response-traits">Species response traits</a></li>
  <li><a href="#community-response-diversity" id="toc-community-response-diversity" class="nav-link" data-scroll-target="#community-response-diversity">Community response diversity</a></li>
  <li><a href="#community-stability" id="toc-community-stability" class="nav-link" data-scroll-target="#community-stability">Community stability</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#example-of-a-single-community" id="toc-example-of-a-single-community" class="nav-link" data-scroll-target="#example-of-a-single-community">Example of a single community</a></li>
  <li><a href="#example-of-a-single-community-1" id="toc-example-of-a-single-community-1" class="nav-link" data-scroll-target="#example-of-a-single-community-1">Example of a single community</a></li>
  <li><a href="#response-diversity-and-community-stability" id="toc-response-diversity-and-community-stability" class="nav-link" data-scroll-target="#response-diversity-and-community-stability">Response diversity and community stability</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Response diversity and stability in the context of a pulse perturbation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In the context of a pulse perturbation:</p>
<ul>
<li>will response diversity measured according to Ross et al (2023) predict community stability?</li>
<li>is there an alternate measure of response diversity that better predicts community stability?</li>
</ul>
<p>We explore these questions using a simulation model of a multispecies competition model, in which species intrinsic growth rate is a bell-shaped function of temperature, and each species can have a different temperature optimum. A pulse perturbation is created by briefly setting temperature lower than the control temperature, and then returning it to control temperature.</p>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="the-multispecies-model" class="level2">
<h2 class="anchored" data-anchor-id="the-multispecies-model">The multispecies model</h2>
<p>…to be completed…</p>
<p>The following need to be specified for a community (in addition to the number of species):</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Property</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Level</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">a_b</td>
<td style="text-align: left;">Species</td>
<td style="text-align: left;">Intercept of intrinsic growth rate - temperature function of species i.</td>
</tr>
<tr class="even">
<td style="text-align: left;">b_{opt,i}</td>
<td style="text-align: left;">Species</td>
<td style="text-align: left;">Temperature at which intrinsic growth rate is highest for species i.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">s_i</td>
<td style="text-align: left;">Species</td>
<td style="text-align: left;">Width of intrinsic growth rate - temperature function of species i.</td>
</tr>
<tr class="even">
<td style="text-align: left;">a_d</td>
<td style="text-align: left;">Species</td>
<td style="text-align: left;">Intercept of death rate - temperature function of species i.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">z_i</td>
<td style="text-align: left;">Species</td>
<td style="text-align: left;">Slope of death rate - temperature function of species i.</td>
</tr>
<tr class="even">
<td style="text-align: left;">alpha_{i,j}</td>
<td style="text-align: left;">Interaction</td>
<td style="text-align: left;">Strength of interspecific effect of species j on species i.</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="experimental-treatments" class="level2">
<h2 class="anchored" data-anchor-id="experimental-treatments">Experimental treatments</h2>
<section id="pulse-pertubation-treatment" class="level3">
<h3 class="anchored" data-anchor-id="pulse-pertubation-treatment">Pulse pertubation treatment</h3>
<p>Temperature is constant in one treatment, and is pulse perturbed in another. For simplicity, we always make the perturbed temperature lower than the control temperature.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="community-composition-treatment" class="level3">
<h3 class="anchored" data-anchor-id="community-composition-treatment">Community composition treatment</h3>
<p>We manipulate the composition of the communities by changing the distributions from which parameter values are drawn. For example, the optimum temperature for growth for each species are drawn from a uniform distribution; we make a set of communities that vary in the mean and in the range of this uniform distribution. We show some communities in the Result section of this report.</p>
</section>
<section id="strength-of-species-interactions-treatment" class="level3">
<h3 class="anchored" data-anchor-id="strength-of-species-interactions-treatment">Strength of species interactions treatment</h3>
<p>… to be done …</p>
</section>
</section>
<section id="analyses" class="level2">
<h2 class="anchored" data-anchor-id="analyses">Analyses</h2>
<section id="species-response-traits" class="level3">
<h3 class="anchored" data-anchor-id="species-response-traits">Species response traits</h3>
<p>We calculated two types of species response trait. First was a response trait based on the temperature response curve of a species. For this trait, we calculated the effect of the perturbation on intrinsic growth rate (perturbation temperature intrinsic growth rate - control temperature intrinsic growth rate).</p>
<p>Second was a response trait based on the observed response of the species to the pulse pertubation in the community context. Hence this response trait depends on the direct effect of the pulse on a species, and also the indirect effects via other species in the community.</p>
</section>
<section id="community-response-diversity" class="level3">
<h3 class="anchored" data-anchor-id="community-response-diversity">Community response diversity</h3>
<p><em>For the moment we don’t calculate the response diversity, but rather then mean of the response trait values and the variance of the response trait values of the species in a community. Maybe we see enough with that, maybe we benefit from using a measure of response diversity.</em></p>
</section>
<section id="community-stability" class="level3">
<h3 class="anchored" data-anchor-id="community-stability">Community stability</h3>
<p>This was calculated as the effect of the pulse perturbation on the total community biomass. Specifically the area between the control and perturbed dynamics.</p>
</section>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="example-of-a-single-community" class="level2">
<h2 class="anchored" data-anchor-id="example-of-a-single-community">Example of a single community</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>case_number <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here in the top row is a panel for each species, with the control and the pulse perturbed dynamics. Bottom row is the difference between the perturbed and control treatment.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here are the corresponding species response traits in this case:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">species_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">species_tot_deltabm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">igr_pert_effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Spp1</td>
<td style="text-align: right;">720.528201</td>
<td style="text-align: right;">2.9775579</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp2</td>
<td style="text-align: right;">512.146553</td>
<td style="text-align: right;">2.8276904</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spp3</td>
<td style="text-align: right;">88.487353</td>
<td style="text-align: right;">1.4660778</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp4</td>
<td style="text-align: right;">4.868238</td>
<td style="text-align: right;">0.1786467</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spp5</td>
<td style="text-align: right;">150.085670</td>
<td style="text-align: right;">1.8700289</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp6</td>
<td style="text-align: right;">-9.545154</td>
<td style="text-align: right;">-0.4983917</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spp7</td>
<td style="text-align: right;">-15.356323</td>
<td style="text-align: right;">-1.0223785</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp8</td>
<td style="text-align: right;">24.342455</td>
<td style="text-align: right;">0.6717259</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spp9</td>
<td style="text-align: right;">-8.227285</td>
<td style="text-align: right;">-0.4116091</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp10</td>
<td style="text-align: right;">84.979180</td>
<td style="text-align: right;">1.4365582</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>And the total biomass dynamics:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="example-of-a-single-community-1" class="level2">
<h2 class="anchored" data-anchor-id="example-of-a-single-community-1">Example of a single community</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>case_number <span class="ot">&lt;-</span> <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here are the corresponding species response traits in this case:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">species_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">species_tot_deltabm</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">igr_pert_effect</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Spp1</td>
<td style="text-align: right;">-14.4845990</td>
<td style="text-align: right;">-0.9224918</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp2</td>
<td style="text-align: right;">-17.7711054</td>
<td style="text-align: right;">-1.3725812</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spp3</td>
<td style="text-align: right;">-0.8232354</td>
<td style="text-align: right;">-0.0339089</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp4</td>
<td style="text-align: right;">-7.5963891</td>
<td style="text-align: right;">-0.3727566</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spp5</td>
<td style="text-align: right;">-15.9075772</td>
<td style="text-align: right;">-1.0915440</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp6</td>
<td style="text-align: right;">18.2326508</td>
<td style="text-align: right;">0.5431900</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spp7</td>
<td style="text-align: right;">-14.2797414</td>
<td style="text-align: right;">-0.9004908</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp8</td>
<td style="text-align: right;">-0.3466286</td>
<td style="text-align: right;">-0.0141275</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Spp9</td>
<td style="text-align: right;">109.3378837</td>
<td style="text-align: right;">1.6240648</td>
</tr>
<tr class="even">
<td style="text-align: left;">Spp10</td>
<td style="text-align: right;">405.7989238</td>
<td style="text-align: right;">2.6632888</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="response-diversity-and-community-stability" class="level2">
<h2 class="anchored" data-anchor-id="response-diversity-and-community-stability">Response diversity and community stability</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="main-report_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>